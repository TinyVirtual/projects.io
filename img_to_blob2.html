<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Image → data:image/... (Blob) — Converter</title>
  <style>
    :root{font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    body{max-width:900px;margin:36px auto;padding:18px;color:#111}
    label{display:inline-block;margin-bottom:8px;font-weight:600}
    .row{display:flex;gap:18px;align-items:flex-start}
    .col{flex:1;min-width:0}
    input[type=file]{display:block}
    #previewBox{border:1px dashed #ccc;padding:12px;border-radius:8px;text-align:center}
    #preview{max-width:100%;height:auto;display:block;margin:0 auto}
    textarea{width:100%;height:160px;padding:8px;font-family:monospace;resize:vertical}
    button{margin-right:8px;padding:8px 12px;border-radius:6px;border:1px solid #888;background:#f4f4f4;cursor:pointer}
    button:active{transform:translateY(1px)}
    .muted{color:#666;font-size:0.9rem}
    footer{margin-top:18px;color:#666;font-size:0.9rem}
  </style>
</head>
<body>
  <h1>Image → data:image/... Converter</h1>

  <label for="file">Upload Image (png, jpeg, gif, webp)</label>
  <input id="file" type="file" accept="image/png, image/jpeg, image/gif, image/webp" />
  <div style="height:10px"></div>

  <h2>Preview</h2>
  <div id="previewBox">
    <img id="preview" alt="No image selected" src="" />
    <div id="previewInfo" class="muted">No file selected.</div>
  </div>

  <h2 style="margin-top:18px">Data URL</h2>
  <div class="row">
    <div class="col">
      <textarea id="dataUrl" placeholder="Your data:image/... will appear here" readonly></textarea>

      <div style="margin-top:8px">
        <button id="copyBtn">Copy</button>
        <button id="downloadBtn">Download as .txt</button>
        <button id="copyJsonBtn">Copy JSON</button>
      </div>
    </div>
  </div>

  <footer>Drop an image onto the file input or click it to choose. Data URLs are base64 encoded — large files produce long text.</footer>

  <script>
    const fileInput = document.getElementById('file');
    const preview = document.getElementById('preview');
    const previewInfo = document.getElementById('previewInfo');
    const dataUrlArea = document.getElementById('dataUrl');
    const copyBtn = document.getElementById('copyBtn');
    const downloadBtn = document.getElementById('downloadBtn');
    const copyJsonBtn = document.getElementById('copyJsonBtn');

    function reset() {
      preview.src = '';
      preview.alt = 'No image selected';
      previewInfo.textContent = 'No file selected.';
      dataUrlArea.value = '';
    }

    function setLoading() {
      preview.src = '';
      preview.alt = 'Loading...';
      previewInfo.textContent = 'Loading...';
      dataUrlArea.value = '';
    }

    fileInput.addEventListener('change', async (ev) => {
      const f = ev.target.files && ev.target.files[0];
      if (!f) { reset(); return; }
      if (!f.type.startsWith('image/')) { alert('Please select an image file.'); reset(); return; }
      setLoading();

      const reader = new FileReader();
      reader.onload = () => {
        const dataUrl = reader.result; // string like data:image/png;base64,....
        preview.src = dataUrl;
        preview.alt = f.name;
        previewInfo.textContent = f.name + ' • ' + Math.round(f.size/1024) + ' KB • ' + f.type;
        dataUrlArea.value = dataUrl;
      };
      reader.onerror = () => {
        alert('Failed to read file.');
        reset();
      };
      reader.readAsDataURL(f);
    });

    copyBtn.addEventListener('click', async () => {
      const text = dataUrlArea.value;
      if (!text) return alert('No data URL to copy.');
      try {
        await navigator.clipboard.writeText(text);
        copyBtn.textContent = 'Copied ✓';
        setTimeout(()=> copyBtn.textContent = 'Copy', 1500);
      } catch (err) {
        // fallback: select + execCommand
        dataUrlArea.select();
        document.execCommand('copy');
        copyBtn.textContent = 'Copied ✓';
        setTimeout(()=> copyBtn.textContent = 'Copy', 1500);
      }
    });

    downloadBtn.addEventListener('click', () => {
      const text = dataUrlArea.value;
      if (!text) return alert('No data URL to download.');
      const blob = new Blob([text], {type: 'text/plain'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'image-data.txt';
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    });

    copyJsonBtn.addEventListener('click', async () => {
      const text = dataUrlArea.value;
      if (!text) return alert('No data URL to copy.');
      const json = JSON.stringify({ imageBlob: text });
      try {
        await navigator.clipboard.writeText(json);
        copyJsonBtn.textContent = 'Copied JSON ✓';
        setTimeout(()=> copyJsonBtn.textContent = 'Copy JSON', 1500);
      } catch (err) {
        // fallback
        const ta = document.createElement('textarea');
        ta.value = json; document.body.appendChild(ta);
        ta.select(); document.execCommand('copy'); ta.remove();
        copyJsonBtn.textContent = 'Copied JSON ✓';
        setTimeout(()=> copyJsonBtn.textContent = 'Copy JSON', 1500);
      }
    });

    // drag & drop support onto the whole window (drops into fileInput)
    ;(function setupDnd(){
      const dropTarget = document.body;
      dropTarget.addEventListener('dragover', e => { e.preventDefault(); e.dataTransfer.dropEffect = 'copy'; });
      dropTarget.addEventListener('drop', e => {
        e.preventDefault();
        const f = e.dataTransfer.files && e.dataTransfer.files[0];
        if (!f) return;
        // populate file input programmatically
        const dataTransfer = new DataTransfer();
        dataTransfer.items.add(f);
        fileInput.files = dataTransfer.files;
        // trigger change
        const ev = new Event('change');
        fileInput.dispatchEvent(ev);
      });
    })();

    // init
    reset();
  </script>
</body>
</html>