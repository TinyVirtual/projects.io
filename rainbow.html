<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Rainbow Text GIF Generator</title>

<link href="https://fonts.googleapis.com/css2?family=Montserrat&family=Nunito&family=Oswald&family=Lobster&family=Permanent+Marker&family=Patrick+Hand&family=Playfair+Display&display=swap" rel="stylesheet" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/gif.js/0.2.0/gif.js"></script>
<style>
  body { font-family: sans-serif; text-align: center; margin: 20px; }
  canvas { display: none; }
  .controls { margin: 15px 0; }
  input, select, button { margin: 5px; padding: 5px; }
  #output a, #output img { display: block; margin: 10px auto; max-width: 90vw; }
</style>
<script type="application/json" id="font-styles">
{
  "fonts": [
    "Arial",
    "Comic Sans MS, Patrick Hand, cursive",
    "Playfair Display, Times New Roman, monospace",
    "Nunito, sans-serif",
    "Montserrat, sans-serif",
    "Oswald, sans-serif",
    "Lobster, cursive",
    "Permanent Marker, cursive",
    "Pixelify Sans, monospace"
  ]
}
</script>
</head>
<body>
<h1>Rainbow Text GIF Generator</h1>
<div id="ui">
  <div class="controls">
    <input type="text" id="text-input" placeholder="Your Text" size="30" />
    <button id="generate-btn">Generate GIF</button>
  </div>
  <details>
    <summary>Additional Settings</summary>
    <div class="controls">
      <label>Font Size: <input type="number" id="size-input" value="16" min="8" /></label>
      <label>Font Weight: <input type="number" id="weight-input" value="400" min="100" step="100" /></label>
      <label>Font Style:
        <select id="style-input">
          <option value="0">Arial</option>
          <option value="1">Comic Sans MS, Patrick Hand, cursive</option>
          <option value="2">Playfair Display, Times New Roman, monospace</option>
          <option value="3">Nunito</option>
          <option value="4">Montserrat</option>
          <option value="5">Oswald</option>
          <option value="6">Lobster</option>
          <option value="7">Permanent Marker</option>
          <option value="8">Pixelify Sans</option>
        </select>
      </label>
      <fieldset>
        <legend>Text Format</legend>
        <label><input type="checkbox" id="bold-input" /> Bold</label>
        <label><input type="checkbox" id="italic-input" /> Italic</label>
        <label><input type="checkbox" id="underline-input" /> Underline</label>
        <label><input type="checkbox" id="strike-input" /> Strikethrough</label>
      </fieldset>
    </div>
  </details>
</div>
<canvas id="canvas"></canvas>
<div id="output"></div>
<script>
  // Load fonts
  const fontData = JSON.parse(document.getElementById('font-styles').textContent);
  const fonts = fontData.fonts;
  function getParams() {
    const url = new URL(window.location.href);
    return {
      t: url.searchParams.get('t') || '',
      s: parseFloat(url.searchParams.get('s')) || 16,
      w: parseInt(url.searchParams.get('w')) || 400,
      f: parseInt(url.searchParams.get('f')) || 0,
      c: parseInt(url.searchParams.get('c')) || 0
    };
  }
  function applyTextProps(ctx, params) {
    const style = (params.c & 2) ? 'italic ' : '';
    const weight = (params.c & 1) ? 'bold ' : (params.w || 400) + ' ';
    const size = params.s || 16;
    const family = fonts[params.f] || fonts[0];
    ctx.font = `${style}${weight}${size}px ${family}`;
    ctx.textBaseline = 'top';
  }
  function drawFrame(ctx, params, phase) {
    const txt = params.t;
    const { width } = ctx.canvas;
    const grad = ctx.createLinearGradient(0, 0, width, 0);
    ['red','orange','yellow','green','blue','indigo','violet'].forEach((c,i) => {
      grad.addColorStop(((i/6)+phase)%1, c);
    });
    ctx.clearRect(0,0,ctx.canvas.width,ctx.canvas.height);
    ctx.fillStyle = grad;
    ctx.fillText(txt,5,5);
    const m = ctx.measureText(txt);
    if (params.c & 4) { ctx.fillRect(5,5+m.actualBoundingBoxAscent+2, m.width,2); }
    if (params.c & 8) { ctx.fillRect(5,5+m.actualBoundingBoxAscent/2, m.width,2); }
  }
  function generateGIF(params) {
    const tmp = document.createElement('canvas');
    const tctx = tmp.getContext('2d', { willReadFrequently: true });
    applyTextProps(tctx, params);
    const m = tctx.measureText(params.t);
    const pad = 5;
    tmp.width = Math.ceil(m.width)+pad*2;
    tmp.height = Math.ceil(m.actualBoundingBoxAscent + m.actualBoundingBoxDescent)+pad*2;
    const workerPath = '/external/gif.worker.js';
    const gif = new GIF({ workers:2, quality:10, width:tmp.width, height:tmp.height, workerScript: workerPath });
    for (let i=0;i<20;i++){
      drawFrame(tmp.getContext('2d', { willReadFrequently: true }), params, i/20);
      gif.addFrame(tmp, { delay:100, copy:true });
    }
    gif.on('finished', blob => {
      const reader = new FileReader();
      reader.onload = () => {
        const dataUrl = reader.result;
        showResult(params.t, dataUrl);
      };
      reader.readAsDataURL(blob);
    });
    gif.render();
  }
  function showResult(text, url) {
    document.getElementById('ui').style.display='none';
    const out = document.getElementById('output');
    // Markdown with data URI
    out.innerHTML = `
      <p>Markdown:</p>
      <textarea rows="3" cols="50">![${text}](${url})</textarea>
      <button onclick="navigator.clipboard.writeText('![${text}](${url})')">Copy Markdown</button>
      <br><button onclick="window.open('${url}','_blank')">Open GIF</button>
      <img src="${url}" alt="${text}" />
      <button onclick="location.reload()">Generate Other</button>
    `;
  }
  document.getElementById('generate-btn').addEventListener('click', ()=>{
    const p = getParams();
    p.t = document.getElementById('text-input').value || p.t || 'Hello World!';
    p.s = parseFloat(document.getElementById('size-input').value)||p.s;
    p.w = parseInt(document.getElementById('weight-input').value)||p.w;
    p.f = parseInt(document.getElementById('style-input').value);
    p.c = (document.getElementById('bold-input').checked?1:0)|(document.getElementById('italic-input').checked?2:0)|
          (document.getElementById('underline-input').checked?4:0)|(document.getElementById('strike-input').checked?8:0);
    generateGIF(p);
  });
  // Auto-run if ?t= and no UI needed
  const params = getParams();
  if (params.t) { document.getElementById('text-input').value = params.t; }
</script>
</body>
</html>
