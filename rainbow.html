<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Rainbow Text GIF Generator</title>
  <style>
    body { font-family: sans-serif; max-width: 600px; margin: 2em auto; }
    label { display: block; margin-top: 1em; }
    input, select { width: 100%; padding: 0.5em; }
    button { margin-top: 1em; padding: 0.7em 1.5em; }
    #result { display: none; margin-top: 2em; }
    #creator { display: block; }
  </style>
</head>
<body>

<div id="creator">
  <h1>Create Rainbow Text GIF</h1>
  <label>Text: <input id="text" type="text"></label>
  <label>Font: <input id="font" type="text" value="Arial"></label>
  <label>Size: <input id="size" type="number" value="48"></label>
  <label>Weight: <input id="weight" type="text" value="bold"></label>
  <label>Cycle Time (s): <input id="cycle" type="number" value="3"></label>
  <button id="generate">Generate</button>
</div>

<div id="result">
  <h2>Generated GIF:</h2>
  <img id="gif" alt="Generated GIF">
  <p>Direct URL: <a id="gifLink" target="_blank">Open GIF</a></p>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/gif.js/0.2.0/gif.min.js"></script>
<script>
  function getParams() {
    const params = new URLSearchParams(location.search);
    return {
      t: params.get('t'),
      f: params.get('f'),
      s: params.get('s'),
      w: params.get('w'),
      c: params.get('c')
    };
  }

  function hasAllParams(p) {
    return p.t && p.f && p.s && p.w && p.c;
  }

  function generateGIF({t, f, s, w, c}, callback) {
    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d');
    canvas.width = 600;
    canvas.height = 150;
    ctx.textBaseline = 'middle';
    ctx.textAlign = 'center';
    ctx.font = `${w} ${s}px ${f}`;
    
    const gif = new GIF({ workers: 2, quality: 10, width: canvas.width, height: canvas.height });
    
    const steps = 60;
    for (let i = 0; i < steps; i++) {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      const hue = (i / steps) * 360;
      ctx.fillStyle = `hsl(${hue}, 100%, 50%)`;
      ctx.fillText(t, canvas.width / 2, canvas.height / 2);
      gif.addFrame(ctx, {copy: true, delay: (c * 1000) / steps});
    }
    
    gif.on('finished', blob => callback(URL.createObjectURL(blob)));
    gif.render();
  }

  function showResult(url) {
    document.getElementById('creator').style.display = 'none';
    document.getElementById('result').style.display = 'block';
    document.getElementById('gif').src = url;
    document.getElementById('gifLink').href = url;
  }

  const params = getParams();

  if (hasAllParams(params)) {
    generateGIF(params, url => {
      location.href = url;
    });
  } else {
    document.getElementById('generate').addEventListener('click', () => {
      const t = document.getElementById('text').value;
      const f = document.getElementById('font').value;
      const s = document.getElementById('size').value;
      const w = document.getElementById('weight').value;
      const c = document.getElementById('cycle').value;
      generateGIF({t, f, s, w, c}, url => {
        showResult(url);
        history.replaceState(null, '', `?t=${encodeURIComponent(t)}&f=${encodeURIComponent(f)}&s=${s}&w=${encodeURIComponent(w)}&c=${c}`);
      });
    });
  }
</script>

</body>
</html>
